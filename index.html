<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daewoong S&T Inventory System</title>
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Excel Processing Library (SheetJS) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(229, 231, 235, 0.5); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Firebase Configuration & Global Variables ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'daewoong-snt-prod';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;

        // Initialize Firebase safely
        let db, auth;
        try {
            if (firebaseConfig && !firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
            } else if (firebase.apps.length) {
                // Already initialized
                db = firebase.firestore();
                auth = firebase.auth();
            } else {
                console.warn("Firebase config is missing. App will run in UI-only mode.");
            }
        } catch (e) {
            console.error("Firebase init error:", e);
        }

        const { useState, useEffect, useMemo } = React;

        // --- Internal Icons (Lucide Replacements) ---
        // 외부 라이브러리 의존성을 제거하여 안정성을 확보했습니다.
        const Icons = {
            LayoutDashboard: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
            ),
            Upload: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
            ),
            Warehouse: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z"/><path d="M6 18h12"/><path d="M6 14h12"/><rect width="12" height="12" x="6" y="10"/></svg>
            ),
            Plane: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 12h5"/><path d="M13 12h8"/><path d="M13 8h7"/><path d="M13 16h7"/><path d="M6 16.5a1.5 1.5 0 0 1-3 0 1.5 1.5 0 0 1 3 0Z"/><path d="M22 12.5a1.5 1.5 0 0 1-3 0 1.5 1.5 0 0 1 3 0Z"/></svg>
            ),
            LogOut: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
            ),
            Search: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            ),
            FileSpreadsheet: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></svg>
            ),
            RefreshCw: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
            ),
            Trash2: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
            ),
            Tag: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l5 5a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828l-5-5z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>
            ),
            Filter: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
            ),
            ArrowRightLeft: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m16 3 4 4-4 4"/><path d="M20 7H4"/><path d="m8 21-4-4 4-4"/><path d="M4 17h16"/></svg>
            ),
            Boxes: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2.97 12.92A2 2 0 0 0 2 14.61v6.81a2 2 0 0 0 1.93 2L12 21.68l8.07 1.74a2 2 0 0 0 1.93-2v-6.81a2 2 0 0 0-.97-1.69l-9-5.12a2 2 0 0 0-1.92 0l-9 5.12Z"/><path d="m7 15.24 5 2.86 5-2.86"/><path d="M2 14.61V2.38a2 2 0 0 1 1.93-2L12 2.12l8.07-1.74a2 2 0 0 1 1.93 2v12.23"/></svg>
            ),
            Menu: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
            ),
            X: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            )
        };

        const { 
            LayoutDashboard, Upload, Warehouse, Plane, LogOut, 
            Search, FileSpreadsheet, RefreshCw, Trash2, Tag, 
            Filter, ArrowRightLeft, Boxes, Menu, X
        } = Icons;

        // --- Helper Functions ---
        
        // 원코일 자동 분류 로직 (예시: 폭과 두께에 따라 등급 분류)
        const classifyRawCoil = (width, thickness) => {
            const w = parseFloat(width);
            const t = parseFloat(thickness);
            
            if (isNaN(w) || isNaN(t)) return "미분류";

            // 예시 로직: 광폭(1219 이상) vs 표준
            if (w >= 1219) return "광폭(Wide)";
            if (w < 1219 && w >= 1000) return "표준(Std)";
            return "협폭(Narrow)";
        };

        const formatNumber = (num) => new Intl.NumberFormat('ko-KR').format(num);

        // --- Main Component ---
        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('dashboard'); // dashboard, inventory, upload, partners
            const [inventory, setInventory] = useState([]);
            const [loading, setLoading] = useState(true);
            const [uploadLog, setUploadLog] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterType, setFilterType] = useState('All');
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [firebaseError, setFirebaseError] = useState(false);

            // --- Auth & Data Fetching ---
            useEffect(() => {
                if (!auth) {
                    setFirebaseError(true);
                    setLoading(false);
                    return;
                }

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await auth.signInWithCustomToken(__initial_auth_token);
                        } else {
                            await auth.signInAnonymously();
                        }
                    } catch (err) {
                        console.error("Auth failed:", err);
                        setFirebaseError(true);
                        setLoading(false);
                    }
                };
                initAuth();

                const unsubscribeAuth = auth.onAuthStateChanged((u) => {
                    setUser(u);
                    if (!u) setLoading(false);
                });
                return () => unsubscribeAuth();
            }, []);

            useEffect(() => {
                if (!user || !db) return;
                
                // Firestore: Public Data (Shared Inventory)
                const unsubscribeData = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('inventory')
                    .orderBy('entryDate', 'desc')
                    .onSnapshot((snapshot) => {
                        const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setInventory(items);
                        setLoading(false);
                    }, (error) => {
                        console.error("Data fetch error:", error);
                        setLoading(false);
                    });

                return () => unsubscribeData();
            }, [user]);

            // --- Handlers ---

            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (!db) {
                    alert("데이터베이스 연결 실패: 설정이 올바르지 않습니다.");
                    return;
                }

                const reader = new FileReader();
                reader.onload = async (evt) => {
                    try {
                        const bstr = evt.target.result;
                        const workbook = XLSX.read(bstr, { type: 'binary' });
                        const wsname = workbook.SheetNames[0];
                        const ws = workbook.Sheets[wsname];
                        const data = XLSX.utils.sheet_to_json(ws);

                        const batch = db.batch();
                        let count = 0;
                        const newLogs = [];

                        data.forEach((row) => {
                            // 엑셀 컬럼 매핑
                            const type = row['품명'] || row['Type'] || 'Sheet';
                            const spec = row['강종'] || row['Spec'] || 'CQ';
                            const width = row['폭'] || row['Width'] || 0;
                            const thickness = row['두께'] || row['Thickness'] || 0;
                            const length = row['길이'] || row['Length'] || 0;
                            const weight = row['중량'] || row['Weight'] || 0;
                            const company = row['업체명'] || row['Company'] || '미지정';
                            const coilNo = row['CoilNo'] || row['관리번호'] || `DST-${Date.now()}-${Math.floor(Math.random()*1000)}`;

                            let category = '';
                            
                            // 3. 재고 분류 로직
                            if (type.includes('Coil') || type.includes('코일')) {
                                category = classifyRawCoil(width, thickness);
                            } else if (type.includes('Skelp') || type.includes('스켈프')) {
                                category = 'Skelp';
                            } else {
                                category = 'Sheet/Plate';
                            }

                            const docRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('inventory').doc();
                            batch.set(docRef, {
                                type: type,
                                spec: spec,
                                width: width,
                                thickness: thickness,
                                length: length,
                                weight: weight,
                                company: company,
                                coilNo: coilNo,
                                category: category,
                                entryDate: new Date().toISOString(),
                                createdBy: user.uid
                            });
                            count++;
                        });

                        await batch.commit();
                        setUploadLog(prev => [`${count}건의 데이터가 성공적으로 업로드 및 분류되었습니다.`, ...prev]);
                        alert(`${count}건 업로드 완료`);
                    } catch (error) {
                        console.error("Upload Error:", error);
                        alert("엑셀 처리 중 오류가 발생했습니다. 형식을 확인해주세요.");
                    }
                };
                reader.readAsBinaryString(file);
            };

            const handleDelete = async (id) => {
                if(!confirm("정말 삭제하시겠습니까?")) return;
                try {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('inventory').doc(id).delete();
                } catch(err) {
                    console.error(err);
                }
            };

            // --- Derived Data ---
            
            const filteredInventory = useMemo(() => {
                return inventory.filter(item => {
                    const matchesSearch = 
                        (item.company && item.company.includes(searchTerm)) || 
                        (item.spec && item.spec.includes(searchTerm)) ||
                        (item.coilNo && item.coilNo.includes(searchTerm));
                    const matchesType = filterType === 'All' ? true : 
                                        filterType === 'Coil' ? (item.type.includes('Coil') || item.type.includes('코일')) :
                                        filterType === 'Sheet' ? (item.type.includes('Sheet') || item.type.includes('시트')) : 
                                        true;
                    return matchesSearch && matchesType;
                });
            }, [inventory, searchTerm, filterType]);

            const stats = useMemo(() => {
                const totalWeight = inventory.reduce((acc, cur) => acc + (parseFloat(cur.weight) || 0), 0);
                const totalCount = inventory.length;
                const companyCount = new Set(inventory.map(i => i.company)).size;
                return { totalWeight, totalCount, companyCount };
            }, [inventory]);

            const inventoryByCompany = useMemo(() => {
                const grouped = {};
                inventory.forEach(item => {
                    const comp = item.company || 'Unknown';
                    if (!grouped[comp]) grouped[comp] = [];
                    grouped[comp].push(item);
                });
                return grouped;
            }, [inventory]);

            // --- Components ---

            const SidebarItem = ({ icon: Icon, label, id }) => (
                <button 
                    onClick={() => { setView(id); setIsSidebarOpen(false); }}
                    className={`w-full flex items-center space-x-3 px-6 py-4 transition-colors ${view === id ? 'bg-blue-800 text-white' : 'text-blue-100 hover:bg-blue-800'}`}
                >
                    <Icon size={20} />
                    <span className="font-medium">{label}</span>
                </button>
            );

            // --- Render ---

            if (firebaseError) {
                return (
                    <div className="h-screen flex flex-col items-center justify-center bg-slate-100 p-4">
                        <div className="bg-white p-8 rounded-lg shadow-lg max-w-md text-center">
                            <div className="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <X size={32} />
                            </div>
                            <h2 className="text-xl font-bold text-slate-800 mb-2">시스템 연결 오류</h2>
                            <p className="text-slate-600 mb-4">
                                데이터베이스(Firebase) 설정 정보를 찾을 수 없습니다.<br/>
                                <span className="text-xs text-slate-400">파일을 직접 실행하셨다면, Firebase Config 설정이 필요합니다.</span>
                            </p>
                            <button onClick={() => window.location.reload()} className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition">
                                새로고침
                            </button>
                        </div>
                    </div>
                );
            }

            if (!user && loading) return <div className="h-screen flex items-center justify-center text-blue-900 font-bold">시스템 로딩중...</div>;

            return (
                <div className="flex h-screen overflow-hidden bg-slate-100 text-slate-800">
                    {/* Sidebar */}
                    <aside className={`fixed z-30 inset-y-0 left-0 w-64 bg-slate-900 shadow-xl transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        <div className="flex items-center justify-center h-20 bg-blue-700 shadow-md">
                            <div className="text-center">
                                <h1 className="text-xl font-bold text-white tracking-wider">DAEWOONG S&T</h1>
                                <p className="text-xs text-blue-200">철강 재고 통합 관리</p>
                            </div>
                        </div>

                        <nav className="mt-6 flex flex-col gap-1">
                            <SidebarItem id="dashboard" icon={LayoutDashboard} label="대시보드 (Dashboard)" />
                            <SidebarItem id="inventory" icon={Boxes} label="전체 재고 (Inventory)" />
                            <SidebarItem id="partners" icon={Warehouse} label="업체별 재고장 (Partners)" />
                            <SidebarItem id="upload" icon={Upload} label="엑셀 입고 (Excel Upload)" />
                        </nav>

                        <div className="absolute bottom-0 w-full bg-slate-800 p-4">
                            <div className="flex items-center space-x-3 mb-4 text-slate-300">
                                <div className="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">
                                    {user?.isAnonymous ? 'G' : 'A'}
                                </div>
                                <div>
                                    <p className="text-sm font-bold">허창수 법인장</p>
                                    <p className="text-xs text-slate-400">관리자 접속</p>
                                </div>
                            </div>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col overflow-hidden">
                        {/* Header */}
                        <header className="flex items-center justify-between h-20 bg-white shadow px-6 z-10">
                            <div className="flex items-center">
                                <button className="lg:hidden mr-4 text-slate-600" onClick={() => setIsSidebarOpen(true)}>
                                    <Menu />
                                </button>
                                <h2 className="text-2xl font-bold text-slate-800">
                                    {view === 'dashboard' && '경영 대시보드'}
                                    {view === 'inventory' && '실시간 재고 현황'}
                                    {view === 'partners' && '거래처별 재고 관리'}
                                    {view === 'upload' && '데이터 일괄 등록'}
                                </h2>
                            </div>
                            <div className="flex items-center space-x-4">
                                <span className="text-sm text-slate-500 hidden md:inline">마지막 동기화: 실시간</span>
                                <div className="h-8 w-8 rounded bg-green-100 text-green-600 flex items-center justify-center">
                                    <RefreshCw size={18} />
                                </div>
                            </div>
                        </header>

                        {/* Content Scroll Area */}
                        <div className="flex-1 overflow-x-hidden overflow-y-auto bg-slate-100 p-6">
                            
                            {/* View: Dashboard */}
                            {view === 'dashboard' && (
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                    <div className="bg-white p-6 rounded-lg shadow-sm border-l-4 border-blue-500">
                                        <div className="flex justify-between items-center">
                                            <div>
                                                <p className="text-sm text-slate-500 font-medium">총 재고 중량</p>
                                                <p className="text-3xl font-bold text-slate-800 mt-1">{formatNumber(stats.totalWeight)} <span className="text-lg text-slate-400">kg</span></p>
                                            </div>
                                            <div className="p-3 bg-blue-50 rounded-full text-blue-600"><Boxes /></div>
                                        </div>
                                    </div>
                                    <div className="bg-white p-6 rounded-lg shadow-sm border-l-4 border-emerald-500">
                                        <div className="flex justify-between items-center">
                                            <div>
                                                <p className="text-sm text-slate-500 font-medium">등록 코일/시트 수</p>
                                                <p className="text-3xl font-bold text-slate-800 mt-1">{formatNumber(stats.totalCount)} <span className="text-lg text-slate-400">매</span></p>
                                            </div>
                                            <div className="p-3 bg-emerald-50 rounded-full text-emerald-600"><FileSpreadsheet /></div>
                                        </div>
                                    </div>
                                    <div className="bg-white p-6 rounded-lg shadow-sm border-l-4 border-purple-500">
                                        <div className="flex justify-between items-center">
                                            <div>
                                                <p className="text-sm text-slate-500 font-medium">관리 업체 수</p>
                                                <p className="text-3xl font-bold text-slate-800 mt-1">{stats.companyCount} <span className="text-lg text-slate-400">개사</span></p>
                                            </div>
                                            <div className="p-3 bg-purple-50 rounded-full text-purple-600"><Warehouse /></div>
                                        </div>
                                    </div>
                                    
                                    {/* Simple Chart Visualization (CSS Bar) */}
                                    <div className="col-span-1 md:col-span-3 bg-white p-6 rounded-lg shadow-sm mt-4">
                                        <h3 className="text-lg font-bold mb-4 text-slate-700">품목별 비중 (Weight 기준)</h3>
                                        <div className="w-full bg-slate-200 rounded-full h-6 flex overflow-hidden">
                                            {(() => {
                                                const coilW = inventory.filter(i => i.type.includes('Coil') || i.type.includes('코일')).reduce((a,b)=>a+(parseFloat(b.weight)||0),0);
                                                const sheetW = inventory.filter(i => i.type.includes('Sheet') || i.type.includes('시트')).reduce((a,b)=>a+(parseFloat(b.weight)||0),0);
                                                const total = coilW + sheetW || 1;
                                                return (
                                                    <>
                                                        <div className="bg-blue-500 h-full flex items-center justify-center text-xs text-white" style={{width: `${(coilW/total)*100}%`}}>Coil ({Math.round((coilW/total)*100)}%)</div>
                                                        <div className="bg-emerald-500 h-full flex items-center justify-center text-xs text-white" style={{width: `${(sheetW/total)*100}%`}}>Sheet ({Math.round((sheetW/total)*100)}%)</div>
                                                    </>
                                                )
                                            })()}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* View: Inventory List */}
                            {view === 'inventory' && (
                                <div className="bg-white rounded-lg shadow-sm overflow-hidden">
                                    <div className="p-4 border-b flex flex-col md:flex-row gap-4 justify-between items-center bg-slate-50">
                                        <div className="flex items-center gap-2 w-full md:w-auto">
                                            <div className="relative flex-1">
                                                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" size={18} />
                                                <input 
                                                    type="text" 
                                                    placeholder="업체명, 강종, 관리번호 검색..." 
                                                    className="pl-10 pr-4 py-2 border rounded-lg w-full md:w-64 focus:ring-2 focus:ring-blue-500 outline-none"
                                                    value={searchTerm}
                                                    onChange={(e) => setSearchTerm(e.target.value)}
                                                />
                                            </div>
                                            <select 
                                                className="p-2 border rounded-lg bg-white"
                                                value={filterType}
                                                onChange={(e) => setFilterType(e.target.value)}
                                            >
                                                <option value="All">전체 품목</option>
                                                <option value="Coil">원코일 (Raw Coil)</option>
                                                <option value="Sheet">시트 (Sheet)</option>
                                            </select>
                                        </div>
                                        <div className="text-sm text-slate-500">
                                            총 {filteredInventory.length}건 조회됨
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left">
                                            <thead className="bg-slate-100 text-slate-600 font-bold uppercase">
                                                <tr>
                                                    <th className="px-6 py-3">업체명</th>
                                                    <th className="px-6 py-3">관리번호</th>
                                                    <th className="px-6 py-3">품명 (분류)</th>
                                                    <th className="px-6 py-3">강종</th>
                                                    <th className="px-6 py-3 text-right">Size (TxWxL)</th>
                                                    <th className="px-6 py-3 text-right">중량 (kg)</th>
                                                    <th className="px-6 py-3 text-center">관리</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-200">
                                                {filteredInventory.map((item) => (
                                                    <tr key={item.id} className="hover:bg-slate-50 transition">
                                                        <td className="px-6 py-4 font-medium text-slate-800">{item.company}</td>
                                                        <td className="px-6 py-4 text-slate-600">{item.coilNo}</td>
                                                        <td className="px-6 py-4">
                                                            <div className="flex flex-col">
                                                                <span className="font-medium text-slate-700">{item.type}</span>
                                                                <span className="text-xs text-blue-500">{item.category}</span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-slate-600">{item.spec}</td>
                                                        <td className="px-6 py-4 text-right font-mono">
                                                            {item.thickness} x {item.width} x {item.length || 'C'}
                                                        </td>
                                                        <td className="px-6 py-4 text-right font-bold text-slate-700">
                                                            {formatNumber(item.weight)}
                                                        </td>
                                                        <td className="px-6 py-4 text-center">
                                                            <button onClick={() => handleDelete(item.id)} className="text-red-400 hover:text-red-600 p-1">
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                                {filteredInventory.length === 0 && (
                                                    <tr>
                                                        <td colSpan="7" className="px-6 py-10 text-center text-slate-400">
                                                            검색 결과가 없습니다.
                                                        </td>
                                                    </tr>
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* View: Partners (Company Separation) */}
                            {view === 'partners' && (
                                <div className="space-y-8">
                                    <div className="bg-blue-50 border border-blue-200 p-4 rounded-lg flex items-start space-x-3">
                                        <Warehouse className="text-blue-600 mt-1" size={20}/>
                                        <div>
                                            <h4 className="font-bold text-blue-800">업체별 재고장 자동 분리</h4>
                                            <p className="text-sm text-blue-600">등록된 재고를 업체명 기준으로 자동 분류하여 표시합니다.</p>
                                        </div>
                                    </div>

                                    {Object.keys(inventoryByCompany).sort().map(companyName => (
                                        <div key={companyName} className="bg-white rounded-lg shadow-lg border border-slate-200 overflow-hidden">
                                            <div className="bg-slate-800 px-6 py-4 flex justify-between items-center text-white">
                                                <h3 className="text-lg font-bold flex items-center gap-2">
                                                    <Warehouse size={18} className="text-yellow-400"/>
                                                    {companyName}
                                                </h3>
                                                <span className="bg-slate-700 px-3 py-1 rounded-full text-xs">
                                                    총 {inventoryByCompany[companyName].length}건 / {formatNumber(inventoryByCompany[companyName].reduce((a,b)=>a+(parseFloat(b.weight)||0),0))} kg
                                                </span>
                                            </div>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-sm">
                                                    <thead className="bg-slate-50 border-b">
                                                        <tr>
                                                            <th className="px-4 py-2 text-left">관리번호</th>
                                                            <th className="px-4 py-2 text-left">품명</th>
                                                            <th className="px-4 py-2 text-left">규격 (Class)</th>
                                                            <th className="px-4 py-2 text-right">Spec (TxWxL)</th>
                                                            <th className="px-4 py-2 text-right">중량</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {inventoryByCompany[companyName].map(item => (
                                                            <tr key={item.id} className="border-b last:border-0 hover:bg-slate-50">
                                                                <td className="px-4 py-2 text-slate-600">{item.coilNo}</td>
                                                                <td className="px-4 py-2">{item.type}</td>
                                                                <td className="px-4 py-2 text-blue-600 text-xs">{item.category}</td>
                                                                <td className="px-4 py-2 text-right font-mono text-slate-500">
                                                                    {item.thickness} x {item.width} x {item.length}
                                                                </td>
                                                                <td className="px-4 py-2 text-right font-medium">
                                                                    {formatNumber(item.weight)}
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* View: Upload */}
                            {view === 'upload' && (
                                <div className="max-w-2xl mx-auto">
                                    <div className="bg-white p-8 rounded-lg shadow-md text-center">
                                        <div className="mx-auto h-16 w-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-4">
                                            <FileSpreadsheet size={32} />
                                        </div>
                                        <h3 className="text-xl font-bold text-slate-800 mb-2">엑셀 재고 일괄 등록</h3>
                                        <p className="text-slate-500 mb-6">
                                            준비된 재고 리스트(xlsx)를 아래 영역에 드래그하거나 클릭하여 업로드하세요.<br/>
                                            <span className="text-xs text-red-500">* 원코일은 사이즈(폭)를 분석하여 자동으로 분류 코드가 생성됩니다.</span>
                                        </p>

                                        <div className="relative border-2 border-dashed border-slate-300 rounded-lg p-12 hover:bg-slate-50 transition cursor-pointer group">
                                            <input 
                                                type="file" 
                                                accept=".xlsx, .xls"
                                                onChange={handleFileUpload}
                                                className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                            />
                                            <div className="flex flex-col items-center">
                                                <Upload className="text-slate-400 group-hover:text-blue-500 mb-3" size={40} />
                                                <span className="text-sm font-medium text-slate-600 group-hover:text-blue-600">
                                                    클릭하여 파일 선택 또는 드래그 앤 드롭
                                                </span>
                                            </div>
                                        </div>

                                        <div className="mt-8 text-left bg-slate-50 p-4 rounded text-sm text-slate-600">
                                            <h5 className="font-bold mb-2 flex items-center"><Tag size={14} className="mr-1"/> 엑셀 작성 가이드 (필수 컬럼명)</h5>
                                            <ul className="list-disc pl-5 space-y-1">
                                                <li><strong>품명 (Type):</strong> 원코일, 스켈프, 시트 등 구분</li>
                                                <li><strong>업체명 (Company):</strong> 재고 소유주 또는 매입처</li>
                                                <li><strong>두께 (Thickness) / 폭 (Width) / 길이 (Length)</strong></li>
                                                <li><strong>중량 (Weight)</strong></li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    {/* Logs */}
                                    {uploadLog.length > 0 && (
                                        <div className="mt-6 bg-white p-4 rounded-lg shadow-sm">
                                            <h4 className="font-bold text-slate-700 mb-2">처리 로그</h4>
                                            <div className="text-sm text-slate-500 space-y-1">
                                                {uploadLog.map((log, i) => (
                                                    <p key={i}>• {log}</p>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>